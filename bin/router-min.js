var Router=function(b,a){this.isActive=false;this.routeMap=[];this.routeHandler=b;this.errorHandler=a;this.history=[];this.activate=function(){this.isActive=true};this.deactivate=function(){this.isActive=false};this.addRoute=function(d){d=d||this.routeHandler;if(!d){throw ("No callback argument provided and no default routeHandler set!")}var c=new Route(d);this.routeMap.push(c);return c};this.sortRoutes=function(d,c){if(d.patterns.length>c.patterns.length){return -1}else{if(d.patterns.length==c.patterns.length){return 0}else{return 1}}};this.triggerRoutes=function(c){if(!this.isActive){return}this.routeMap.sort(this.sortRoutes);var d=this.getMatchedRoute(c);if(!d||!c||!c.length){if(this.errorHandler){this.errorHandler.apply(this)}}else{this.history.push("/"+c.join("/")+"/");d.callback.apply(this,[d.getPayload()])}};this.getMatchedRoute=function(e){var d;var c;for(d in this.routeMap){c=this.routeMap[d];if(c.match(e)){return c}}return null}};var Route=function(a){this.callback=a;this.patterns=[];this.addPath=function(c,b){var d;b=b||"path"+this.patterns.length.toString();if(c instanceof RegExp){d=new Pattern(b,c)}else{if((typeof c)=="string"){d=new Pattern(b,new RegExp("^"+c+"$"))}else{d=new Pattern(b)}}this.patterns.push(d);return this};this.match=function(c){var b;var d;for(b in this.patterns){d=this.patterns[b];if(!d.match(c[b]?c[b].toString():null)){return false}}return c.length?true:false};this.getPayload=function(){var b;var c;var d={};for(b in this.patterns){c=this.patterns[b];d[c.name]=c.value}return d}};var Pattern=function(b,a){this.name=b;this.value=null;this.regularExpression=a;this.match=function(c){if(this.regularExpression){if(this.regularExpression.test(c)){this.value=c;return true}else{this.value=null;return false}}if(!c){this.value=null;return false}else{this.value=c;return true}}};